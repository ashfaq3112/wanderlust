<% layout("/layouts/boilerplate")%>

<% if(typeof success !== 'undefined' && success && success.length > 0) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert" id="successAlert">
        <%= success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <script>
        setTimeout(() => {
            const alert = document.getElementById('successAlert');
            if (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 3000);
    </script>
<% } %>

<% if(typeof error !== 'undefined' && error && error.length > 0) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorAlert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <script>
        setTimeout(() => {
            const alert = document.getElementById('errorAlert');
            if (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 5000);
    </script>
<% } %>

<body>
    <h1>All Listings</h1>
    <!-- <form method="get" action="/listings/new">
        <button>Create New Listing</button>
    </form> -->
    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 g-4">
    <% for (let listing of allListings) { %>
    <div class="col mb-4">
        <a href="/listings/<%= listing._id %>" class="listing-link text-decoration-none">
            <div class="card h-100 shadow-sm hover-shadow">
                <img src="<%= listing.image && listing.image.url ? listing.image.url : 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=1200' %>" class="card-img-top" alt="listing_image" style="height:200px; object-fit:cover;" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=1200';">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><%= listing.title %></h5>
                    <p class="card-text mt-auto">
                        <% if (listing.price) { %>
                            <span class="fw-bold text-primary">&#8377;<%= listing.price.toLocaleString("en-IN") %>/night</span>
                        <% } else { %>
                            <span class="text-muted">Price not available</span>
                        <% } %>
                    </p>
                </div>
            </div>
        </a>
    </div>
    <% } %>
</div>

<style>
.listing-link:hover .card {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    transition: all 0.3s ease;
}
.hover-shadow {
    transition: all 0.3s ease;
}
.card {
    border: none;
    border-radius: 12px;
    overflow: hidden;
}
.card-img-top {
    border-bottom: 3px solid #007bff;
}
</style>

    <!-- <ul>
        <% for(let listing of allListings){ %>
        <li><a href="/listings/<%= listing._id %>"><%= listing.title %></a></li>
        <%} %> -->
    </ul>
</body>
</html>

